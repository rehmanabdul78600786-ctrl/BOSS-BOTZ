const { cmd } = require("../command");
const axios = require("axios");
const fs = require("fs");

async function generateAIImage(conn, m, { q, reply }, apiEndpoint, captionPrefix) {
    try {
        if (!q) return reply("Please provide a prompt for the image.");

        await reply("> *CREATING IMAGINE ...ğŸ”¥*");

        const apiUrl = `${apiEndpoint}?prompt=${encodeURIComponent(q)}`;
        const response = await axios.get(apiUrl, { responseType: "arraybuffer" });

        if (!response || !response.data) {
            return reply("Error: The API did not return a valid image. Try again later.");
        }

        const imageBuffer = Buffer.from(response.data, "binary");

        await conn.sendMessage(m.chat, {
            image: imageBuffer,
            caption: `${captionPrefix}\nâœ¨ Prompt: *${q}*`
        });

    } catch (error) {
        console.error("AI Image Error:", error);
        reply(`An error occurred: ${error.response?.data?.message || error.message || "Unknown error"}`);
    }
}

// FluxAI
cmd({
    pattern: "fluxai",
    alias: ["flux", "imagine"],
    react: "ğŸš€",
    desc: "Generate an image using AI.",
    category: "main",
    filename: __filename
}, (conn, mek, m, args) => generateAIImage(conn, m, args, "https://api.siputzx.my.id/api/ai/flux", "ğŸ’¸ *Imagine Generated By Ã—Âºğ“‘ğ–”ğ™¨ğ™¨ÂºÃ—* ğŸš€"));

// Stable Diffusion
cmd({
    pattern: "stablediffusion",
    alias: ["sdiffusion", "imagine2"],
    react: "ğŸš€",
    desc: "Generate an image using AI.",
    category: "main",
    filename: __filename
}, (conn, mek, m, args) => generateAIImage(conn, m, args, "https://api.siputzx.my.id/api/ai/stable-diffusion", "ğŸ’¸ *Imagine Generated BY ï®©Ù¨Ù€ï®©ï®©Ù¨Ù€â€…ğ‘©ğ‘¶ğ‘ºğ‘ºï®©Ù¨Ù€ï®©ï®©Ù¨Ù€* ğŸš€"));

// StabilityAI
cmd({
    pattern: "stabilityai",
    alias: ["stability", "imagine3"],
    react: "ğŸš€",
    desc: "Generate an image using AI.",
    category: "main",
    filename: __filename
}, (conn, mek, m, args) => generateAIImage(conn, m, args, "https://api.siputzx.my.id/api/ai/stabilityai", "ğŸ’¸ *Imagine Generated BY ğŸ”¥ğŸ¥€ğ˜½Î¿êœ±êœ±ğŸ¥€ğŸ”¥*ğŸš€"));

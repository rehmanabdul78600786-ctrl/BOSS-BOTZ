const config = require('../config')
const { cmd, commands } = require('../command')
const { getGroupAdmins } = require('../lib/functions')

cmd({
    pattern: "tagadmins",
    react: "ğŸ‘‘",
    alias: ["gc_tagadmins"],
    desc: "Tag all admins of the group",
    category: "group",
    use: ".tagadmins [message]",
    filename: __filename
},
async (conn, mek, m, { from, participants, reply, isGroup, senderNumber, prefix, command, args, body }) => {

    try {
        if (!isGroup) return reply("âŒ This command can only be used in groups.");

        // Fetch group metadata
        const metadata = await conn.groupMetadata(from).catch(() => null);
        if (!metadata) return reply("âŒ Failed to fetch group information.");

        const groupName = metadata.subject || "Unknown Group";

        // Get admins
        const admins = getGroupAdmins(participants);
        if (!admins || admins.length === 0)
            return reply("âŒ No admins found in this group.");

        const totalAdmins = admins.length;

        const emojis = ['ğŸ‘‘', 'âš¡', 'ğŸŒŸ', 'âœ¨', 'ğŸ–ï¸', 'ğŸ’', 'ğŸ”±', 'ğŸ›¡ï¸', 'ğŸš€', 'ğŸ†'];
        const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];

        // Extract message after command
        let message = args.length ? args.join(" ") : "Attention Admins";

        // Build message
        let teks = `â–¢ Group: *${groupName}*\n`;
        teks += `â–¢ Admins: *${totalAdmins}*\n`;
        teks += `â–¢ Message: *${message}*\n\n`;
        teks += `â”Œâ”€â”€â”€âŠ· *ADMIN MENTIONS*\n`;

        for (let ad of admins) {
            teks += `${randomEmoji} @${ad.split("@")[0]}\n`;
        }

        teks += "â””â”€â”€âœª BOSSâ”ƒ MD âœªâ”€â”€";

        // Send with mentions
        await conn.sendMessage(from, {
            text: teks,
            mentions: admins
        }, { quoted: mek });

    } catch (e) {
        console.error("TagAdmins Error:", e);
        reply(`âŒ *Error Occurred!!*\n\n${e.message}`);
    }
});
